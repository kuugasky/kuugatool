package io.github.kuugasky.kuugatool.extra.img;

import io.github.kuugasky.kuugatool.core.collection.MapUtil;
import io.github.kuugasky.kuugatool.core.file.FileUtil;
import org.junit.jupiter.api.Test;

import java.util.List;
import java.util.Map;

class ImgCheckUtilTest {

    static String str = "{\"hid\": \"SK220426000128\", \"mid\": \"db526478_vx0t_b6f9\", \"url\": \"?m=db526478_vx0t_b6f9\", \"city\": \"\", \"owner\": \"梁成翀\", \"survey\": [{\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/客厅1152725527.jpg\"}, {\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/客厅1152767948.jpg\"}, {\"name\": \"餐厅\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/餐厅1152805200.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/卫生间1152833505.jpg\"}, {\"name\": \"厨房\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/厨房1152868084.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/卧室1152913219.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/卧室1152949323.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/卧室1152982567.jpg\"}, {\"name\": \"花园\", \"path\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/花园1153045565.jpg\"}], \"checker\": \"梁成翀\", \"creator\": \"梁成翀\", \"vr_cover\": \"https://download.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/resources/spot_1651152691.jpg\", \"owner_org\": \"看房广州\", \"operatorId\": \"saas_admin\", \"operatorIp\": \"127.0.0.1\", \"checker_org\": \"看房广州\", \"short_video\": \"\", \"operatorName\": \"系统\", \"project_name\": \"A17-102\", \"operatorOrgId\": \"000000\", \"owner_account\": \"15820345396\", \"floorplan_info\": {\"floors\": [{\"name\": \"一楼\", \"bw_pic\": \"https://infocdn.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/ht50d6f4b4-c6f7-11ec-bc43-00163e374001_1440_1080.jpg\", \"color_pic\": \"https://infocdn.3dnest.cn/db526478_vx0t_b6f9/2022-04-27-23-04-02/ht50d0e93e-c6f7-11ec-bc43-00163e374001_1440_1080.jpg\"}], \"room_info\": [\"客厅\", \"过道\", \"餐厅\", \"玄关\", \"厨房\", \"阳台\", \"卫生间\", \"卧室\", \"卧室\", \"卧室\", \"花园\"], \"merge_bw_pic\": \"\", \"is_multi_floor\": 0, \"merge_color_pic\": \"\"}, \"operatorSystem\": \"SERVICE_SCHEDULER\", \"checker_account\": \"15820345396\", \"creator_account\": \"15820345396\", \"operatorOrgName\": \"系统\", \"vr_speak_status\": \"0\", \"authenticationWay\": \"BODY\", \"zhongquDataDealStatus\": \"NORMAL\"}";

    @Test
    void extractImageUrls() {
        List<String> imageUrls = ImgCheckUtil.extractImageUrls(str);
        imageUrls.forEach(System.out::println);
    }

    @Test
    void getImgSizeAfterExtractImageUrls() {
        List<ImgCheckUtil.urlSize> imgSizeAfterExtractImageUrls = ImgCheckUtil.getImgSizeAfterExtractImageUrls(str);
        imgSizeAfterExtractImageUrls.forEach(urlSize -> System.out.printf("%s--->%s%n", urlSize.url(), urlSize.size()));
    }

    @Test
    void foreach() {
        Map<String, String> map = MapUtil.newHashMap();
        map.put("K220408000041", "{\"hid\": \"SK220408000041\", \"mid\": \"5b10c546_tRXO_b6f9\", \"url\": \"?m=5b10c546_tRXO_b6f9\", \"city\": \"\", \"owner\": \"李芳婷\", \"survey\": [{\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/客厅0970863691.jpg\"}, {\"name\": \"餐厅\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/餐厅0970887853.jpg\"}, {\"name\": \"厨房\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/厨房0971107544.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/卫生间0971155130.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/卧室0971182780.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/卧室0971204327.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/卧室0971227577.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/卫生间0971245319.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/卧室0971317941.jpg\"}, {\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/客厅0971365339.jpg\"}], \"checker\": \"李芳婷\", \"creator\": \"李芳婷\", \"vr_cover\": \"https://download.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/resources/spot_1649467788.jpg\", \"owner_org\": \"看房佛山\", \"operatorId\": \"saas_admin\", \"operatorIp\": \"127.0.0.1\", \"checker_org\": \"看房佛山\", \"short_video\": \"\", \"operatorName\": \"系统\", \"project_name\": \"美的翰湖苑\", \"operatorOrgId\": \"000000\", \"owner_account\": \"15626049804\", \"floorplan_info\": {\"floors\": [{\"name\": \"一楼\", \"bw_pic\": \"https://infocdn.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/ht55d8218e-b7a4-11ec-bc43-00163e372774_1440_1080.jpg\", \"color_pic\": \"https://infocdn.3dnest.cn/5b10c546_tRXO_b6f9/2022-04-08-23-10-02/ht55d0292a-b7a4-11ec-bc43-00163e372774_1440_1080.jpg\"}], \"room_info\": [\"过道\", \"卧室\", \"餐厅\", \"客厅\", \"过道\", \"卫生间\", \"卧室\", \"卧室\", \"厨房\", \"卫生间\", \"阳台\", \"卧室\"], \"merge_bw_pic\": \"\", \"is_multi_floor\": 0, \"merge_color_pic\": \"\"}, \"operatorSystem\": \"SERVICE_SCHEDULER\", \"checker_account\": \"15626049804\", \"creator_account\": \"15626049804\", \"operatorOrgName\": \"系统\", \"vr_speak_status\": \"0\", \"authenticationWay\": \"BODY\", \"zhongquDataDealStatus\": \"NORMAL\"}");
        map.put("K220408000063", "{\"hid\": \"SK220408000063\", \"mid\": \"04f22518_gIHd_b6f9\", \"url\": \"?m=04f22518_gIHd_b6f9\", \"city\": \"\", \"owner\": \"李芳婷\", \"survey\": [{\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/resources/客厅0967353134.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/resources/卧室0967373478.jpg\"}, {\"name\": \"厨房\", \"path\": \"https://download.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/resources/厨房0967428997.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/resources/卫生间0967450719.jpg\"}], \"checker\": \"李芳婷\", \"creator\": \"李芳婷\", \"vr_cover\": \"https://download.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/resources/spot_1649513078.jpg\", \"owner_org\": \"看房佛山\", \"operatorId\": \"saas_admin\", \"operatorIp\": \"127.0.0.1\", \"checker_org\": \"看房佛山\", \"short_video\": \"\", \"operatorName\": \"系统\", \"project_name\": \"新福港\", \"operatorOrgId\": \"000000\", \"owner_account\": \"15626049804\", \"floorplan_info\": {\"floors\": [{\"name\": \"一楼\", \"bw_pic\": \"https://infocdn.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/htd04ed96c-b80d-11ec-bc43-00163e372774_1440_1080.jpg\", \"color_pic\": \"https://infocdn.3dnest.cn/04f22518_gIHd_b6f9/2022-04-09-19-44-02/htd0487dc4-b80d-11ec-bc43-00163e372774_1440_1080.jpg\"}], \"room_info\": [\"厨房\", \"过道\", \"客厅\", \"卫生间\", \"卧室\"], \"merge_bw_pic\": \"\", \"is_multi_floor\": 0, \"merge_color_pic\": \"\"}, \"operatorSystem\": \"SERVICE_SCHEDULER\", \"checker_account\": \"15626049804\", \"creator_account\": \"15626049804\", \"operatorOrgName\": \"系统\", \"vr_speak_status\": \"0\", \"authenticationWay\": \"BODY\", \"zhongquDataDealStatus\": \"NORMAL\"}");
        // map.put("K220408000055", "{\"hid\": \"SK220408000055\", \"mid\": \"a85706e8_FLIj_b6f9\", \"url\": \"?m=a85706e8_FLIj_b6f9\", \"city\": \"\", \"owner\": \"李芳婷\", \"survey\": [{\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/客厅0918609789.jpg\"}, {\"name\": \"餐厅\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/餐厅0918623765.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卫生间0918646260.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卧室0918662617.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卧室0918677889.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卧室0918693095.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卫生间0918705883.jpg\"}, {\"name\": \"厨房\", \"path\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/厨房0918731419.jpg\"}], \"checker\": \"李芳婷\", \"creator\": \"李芳婷\", \"vr_cover\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/spot_1649481132.jpg\", \"owner_org\": \"看房佛山\", \"operatorId\": \"saas_admin\", \"operatorIp\": \"127.0.0.1\", \"checker_org\": \"看房佛山\", \"short_video\": \"\", \"operatorName\": \"系统\", \"project_name\": \"翰湖苑\", \"operatorOrgId\": \"000000\", \"owner_account\": \"15626049804\", \"floorplan_info\": {\"floors\": [{\"name\": \"一楼\", \"bw_pic\": \"https://infocdn.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/ht7c3033ac-b7c3-11ec-bc43-00163e374001_1440_1080.jpg\", \"color_pic\": \"https://infocdn.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/ht7c28a600-b7c3-11ec-bc43-00163e374001_1440_1080.jpg\"}], \"room_info\": [\"卧室\", \"卫生间\", \"卧室\", \"卫生间\", \"卧室\", \"餐厅\", \"过道\", \"客厅\", \"阳台\", \"厨房\", \"过道\"], \"merge_bw_pic\": \"\", \"is_multi_floor\": 0, \"merge_color_pic\": \"\"}, \"operatorSystem\": \"SERVICE_SCHEDULER\", \"checker_account\": \"15626049804\", \"creator_account\": \"15626049804\", \"operatorOrgName\": \"系统\", \"vr_speak_status\": \"0\", \"authenticationWay\": \"BODY\", \"zhongquDataDealStatus\": \"NORMAL\"}");
        map.put("K220408000055", "{\"hid\": \"SK220408000055\", \"mid\": \"a85706e8_FLIj_b6f9\", \"url\": \"?m=a85706e8_FLIj_b6f9\", \"city\": \"\", \"owner\": \"李芳婷\", \"survey\": [{\"name\": \"客厅\", \"path\": \"http://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/客厅9481150012.jpg\"}, {\"name\": \"餐厅\", \"path\": \"http://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/餐厅9481180182.jpg\"}, {\"name\": \"卧室\", \"path\": \"http://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卧室9481217579.jpg\"}, {\"name\": \"卧室\", \"path\": \"http://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卧室9481235074.jpg\"}, {\"name\": \"卧室\", \"path\": \"http://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卧室9481265683.jpg\"}, {\"name\": \"卫生间\", \"path\": \"http://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/卫生间9517077401.jpg\"}], \"checker\": \"李芳婷\", \"creator\": \"李芳婷\", \"vr_cover\": \"https://download.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/resources/spot_1649481132.jpg\", \"owner_org\": \"看房佛山\", \"operatorId\": \"saas_admin\", \"operatorIp\": \"127.0.0.1\", \"checker_org\": \"看房佛山\", \"short_video\": \"\", \"operatorName\": \"系统\", \"project_name\": \"翰湖苑\", \"operatorOrgId\": \"000000\", \"owner_account\": \"15626049804\", \"floorplan_info\": {\"floors\": [{\"name\": \"一楼\", \"bw_pic\": \"https://infocdn.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/ht7c3033ac-b7c3-11ec-bc43-00163e374001_1440_1080.jpg\", \"color_pic\": \"https://infocdn.3dnest.cn/a85706e8_FLIj_b6f9/2022-04-09-02-16-02/ht7c28a600-b7c3-11ec-bc43-00163e374001_1440_1080.jpg\"}], \"room_info\": [\"卧室\", \"卫生间\", \"卧室\", \"卫生间\", \"卧室\", \"餐厅\", \"过道\", \"客厅\", \"阳台\", \"厨房\", \"过道\"], \"merge_bw_pic\": \"\", \"is_multi_floor\": 0, \"merge_color_pic\": \"\"}, \"operatorSystem\": \"SERVICE_SCHEDULER\", \"checker_account\": \"15626049804\", \"creator_account\": \"15626049804\", \"operatorOrgName\": \"系统\", \"vr_speak_status\": \"0\", \"authenticationWay\": \"BODY\", \"zhongquDataDealStatus\": \"NORMAL\"}");
        map.put("K220408000036", "{\"hid\": \"SK220408000036\", \"mid\": \"3be9d2aa_JlR5_b6f9\", \"url\": \"?m=3be9d2aa_JlR5_b6f9\", \"city\": \"\", \"owner\": \"李芳婷\", \"survey\": [{\"name\": \"客厅\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/客厅0907433147.jpg\"}, {\"name\": \"餐厅\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/餐厅0907460223.jpg\"}, {\"name\": \"厨房\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/厨房0907477889.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/卧室0907537339.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/卧室0907554286.jpg\"}, {\"name\": \"卧室\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/卧室0907590709.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/卫生间0907604682.jpg\"}, {\"name\": \"卫生间\", \"path\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/卫生间0907622972.jpg\"}], \"checker\": \"李芳婷\", \"creator\": \"李芳婷\", \"vr_cover\": \"https://download.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/resources/spot_1649422923.jpg\", \"owner_org\": \"看房佛山\", \"operatorId\": \"saas_admin\", \"operatorIp\": \"127.0.0.1\", \"checker_org\": \"看房佛山\", \"short_video\": \"\", \"operatorName\": \"系统\", \"project_name\": \"0408美的\", \"operatorOrgId\": \"000000\", \"owner_account\": \"15626049804\", \"floorplan_info\": {\"floors\": [{\"name\": \"一楼\", \"bw_pic\": \"https://infocdn.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/hte6dce8ea-b73b-11ec-bc43-00163e374001_1440_1080.jpg\", \"color_pic\": \"https://infocdn.3dnest.cn/3be9d2aa_JlR5_b6f9/2022-04-08-13-56-02/hte6d67172-b73b-11ec-bc43-00163e374001_1440_1080.jpg\"}], \"room_info\": [\"客厅\", \"阳台\", \"餐厅\", \"卧室\", \"过道\", \"卫生间\", \"卧室\", \"卧室\", \"卫生间\", \"过道\", \"厨房\"], \"merge_bw_pic\": \"\", \"is_multi_floor\": 0, \"merge_color_pic\": \"\"}, \"operatorSystem\": \"SERVICE_SCHEDULER\", \"checker_account\": \"15626049804\", \"creator_account\": \"15626049804\", \"operatorOrgName\": \"系统\", \"vr_speak_status\": \"0\", \"authenticationWay\": \"BODY\", \"zhongquDataDealStatus\": \"NORMAL\"}");

        map.forEach((k, v) -> {
            List<String> urls = ImgCheckUtil.extractImageUrls(v);
            urls.forEach(url -> {
                long fileSizeForNetworkUrl = FileUtil.getFileSizeForNetworkUrl(url);
                if (fileSizeForNetworkUrl == 0) {
                    System.out.printf("[%s][%s]%n", k, url);
                }
            });
        });
    }

}